<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Database</title>
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <header style="text-align: center; margin-bottom: 40px;">
            <h1 style="color: white; font-size: 2.5em; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">Chess Database</h1>
            <p style="color: rgba(255,255,255,0.9); font-size: 1.2em; margin: 10px 0 0 0;">Browse and analyze chess games</p>
        </header>
        
        <div style="background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; padding: 20px; border-bottom: 1px solid #eee;">
                <h2 style="margin: 0; font-size: 1.5em;">Games Library</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                    <div style="display: flex; gap: 20px;">
                        <span id="totalGames" style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 0.9em;">Total: 0 games</span>
                        <span id="validGames" style="background: rgba(76,175,80,0.3); padding: 8px 16px; border-radius: 20px; font-size: 0.9em;">Valid: 0</span>
                        <span id="invalidGames" style="background: rgba(244,67,54,0.3); padding: 8px 16px; border-radius: 20px; font-size: 0.9em;">Invalid: 0</span>
                    </div>
                    <button onclick="loadGames()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
            
            <div style="padding: 0;">
                <div id="loading" style="text-align: center; padding: 60px; color: #666; display: block;">
                    <div style="display: inline-block; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #4a90e2; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p style="margin-top: 20px; font-size: 1.1em;">Loading games...</p>
                </div>
                
                <div id="gamesTable" style="display: none;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 15px 20px; text-align: left; font-weight: 600; color: #495057;">Event</th>
                                <th style="padding: 15px 20px; text-align: left; font-weight: 600; color: #495057;">Players</th>
                                <th style="padding: 15px 20px; text-align: left; font-weight: 600; color: #495057;">Date</th>
                                <th style="padding: 15px 20px; text-align: left; font-weight: 600; color: #495057;">Site</th>
                                <th style="padding: 15px 20px; text-align: center; font-weight: 600; color: #495057;">Status</th>
                                <th style="padding: 15px 20px; text-align: center; font-weight: 600; color: #495057;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="gamesTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="error" style="text-align: center; padding: 60px; color: #dc3545; display: none;">
                    <div style="font-size: 3em; margin-bottom: 20px;">‚ö†Ô∏è</div>
                    <h3 style="margin: 0 0 10px 0;">Error Loading Games</h3>
                    <p style="margin: 0; color: #6c757d;">Please make sure the database API is running</p>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        tbody tr:hover {
            background-color: #f8f9fa !important;
        }
        
        .status-valid {
            background: #d4edda !important;
            color: #155724 !important;
            padding: 4px 12px !important;
            border-radius: 12px !important;
            font-size: 0.8em !important;
            font-weight: 600 !important;
        }
        
        .status-invalid {
            background: #f8d7da !important;
            color: #721c24 !important;
            padding: 4px 12px !important;
            border-radius: 12px !important;
            font-size: 0.8em !important;
            font-weight: 600 !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%) !important;
            border: none !important;
            color: white !important;
            padding: 8px 16px !important;
            border-radius: 6px !important;
            text-decoration: none !important;
            font-size: 0.85em !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3) !important;
        }
    </style>

    <script>
        let gamesData = [];
        
        async function loadGames() {
            const loading = document.getElementById('loading');
            const gamesTable = document.getElementById('gamesTable');
            const error = document.getElementById('error');
            
            loading.style.display = 'block';
            gamesTable.style.display = 'none';
            error.style.display = 'none';
            
            try {
                // Fetch both valid and invalid games
                const [validGamesResponse, invalidGamesResponse] = await Promise.all([
                    fetch('/api/games'),
                    fetch('/api/illegal_games')
                ]);
                
                if (!validGamesResponse.ok || !invalidGamesResponse.ok) {
                    throw new Error('Failed to fetch games');
                }
                
                const validGames = await validGamesResponse.json();
                const invalidGames = await invalidGamesResponse.json();
                
                // Combine and mark games
                gamesData = [
                    ...validGames.map(game => ({ ...game, isValid: true })),
                    ...invalidGames.map(game => ({ ...game, isValid: false }))
                ];
                
                renderGamesTable();
                updateStats();
                
                loading.style.display = 'none';
                gamesTable.style.display = 'block';
                
            } catch (err) {
                console.error('Error loading games:', err);
                loading.style.display = 'none';
                error.style.display = 'block';
            }
        }
        
        function renderGamesTable() {
            const tbody = document.getElementById('gamesTableBody');
            tbody.innerHTML = '';
            
            gamesData.forEach((game, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                row.style.backgroundColor = index % 2 === 0 ? '#fff' : '#f8f9fa';
                
                const playerInfo = `${game.white || 'Unknown'} vs ${game.black || 'Unknown'}`;
                const statusBadge = game.isValid 
                    ? '<span class="status-valid">‚úì Valid</span>'
                    : '<span class="status-invalid">‚úó Invalid</span>';
                
                const actionButton = game.isValid 
                    ? `<a href="game.html?id=${game.id}" class="btn-primary">View Moves</a>`
                    : '<span style="color: #6c757d; font-size: 0.8em;">No moves available</span>';
                
                row.innerHTML = `
                    <td style="padding: 15px 20px; border-right: 1px solid #dee2e6;">
                        <div style="font-weight: 500;">${game.event || 'Unknown Event'}</div>
                        ${game.round ? `<div style="font-size: 0.8em; color: #6c757d; margin-top: 2px;">Round ${game.round}</div>` : ''}
                    </td>
                    <td style="padding: 15px 20px; border-right: 1px solid #dee2e6;">
                        <div style="font-weight: 500;">${playerInfo}</div>
                    </td>
                    <td style="padding: 15px 20px; border-right: 1px solid #dee2e6; color: #6c757d;">
                        ${game.date || 'Unknown'}
                    </td>
                    <td style="padding: 15px 20px; border-right: 1px solid #dee2e6; color: #6c757d;">
                        ${game.site || 'Unknown'}
                    </td>
                    <td style="padding: 15px 20px; border-right: 1px solid #dee2e6; text-align: center;">
                        ${statusBadge}
                    </td>
                    <td style="padding: 15px 20px; text-align: center;">
                        ${actionButton}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function updateStats() {
            const total = gamesData.length;
            const valid = gamesData.filter(g => g.isValid).length;
            const invalid = total - valid;
            
            document.getElementById('totalGames').textContent = `Total: ${total} games`;
            document.getElementById('validGames').textContent = `Valid: ${valid}`;
            document.getElementById('invalidGames').textContent = `Invalid: ${invalid}`;
        }
        
        // Load games when page loads
        document.addEventListener('DOMContentLoaded', loadGames);
    </script>
</body>
</html>